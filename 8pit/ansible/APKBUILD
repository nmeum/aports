# Contributor: Łukasz Jendrysik <scadu@yandex.com>
# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: Takuya Noguchi <takninnovationresearch@gmail.com>
# Maintainer: Fabian Affolter <fabian@affolter-engineering.ch>
pkgname=ansible
pkgver=2.5.5
pkgrel=1
pkgdesc="A configuration-management, deployment, task-execution, and multinode orchestration framework"
url="https://ansible.com"
arch="noarch"
license="GPL-3.0-or-later"
_py=py2
depends="python2 $_py-yaml $_py-paramiko $_py-jinja2 $_py-markupsafe $_py-crypto"
makedepends="python2-dev py-setuptools"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://releases.ansible.com/ansible/$pkgname-$pkgver.tar.gz
	0001-Revert-Check-for-regexp-match-when-using-insertbefor.patch
	0002-Revert-Fix-lineinfile-to-insert-line-when-pattern-ex.patch"
builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$builddir"
	python2 setup.py build
}

package() {
	cd "$builddir"
	python2 setup.py install --prefix=/usr --root="$pkgdir"

	mkdir -p "$pkgdir"/usr/share/man/man1
	install -Dm644 "$builddir"/docs/man/man1/*.1 \
		"$pkgdir"/usr/share/man/man1/

	mkdir -p "$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 examples/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 README.rst "$pkgdir"/usr/share/doc/$pkgname
}

sha512sums="a3d50539d2a109dc0bbcdb440e0800b917f63141dce935e6426cb6bdc51e3a93e02f05c23714c24ab00b19842a86677b8d2f2455d20ca15410fa8d3c8ba379ca  ansible-2.5.5.tar.gz
153203d7e9cd77868743792ce659be0e3fac88221c9a5e0474be07182fa5083f817ebfbf2e31cf30a4ec34c4f682e71b6113c5769525dc28ab6f088ec75133fa  0001-Revert-Check-for-regexp-match-when-using-insertbefor.patch
aa75b5ab7d5dd534a54e7b05cabc01e4840d12758251c65544feba94888fd31536558ebb0d719c4582d97bd6faef9bbcc37f6f60155f29ae6d03fa5a68270772  0002-Revert-Fix-lineinfile-to-insert-line-when-pattern-ex.patch"
