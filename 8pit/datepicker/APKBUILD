maintainer="SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>"
pkgname=datepicker
pkgver=1.0.0
pkgrel=0
pkgdesc="An fzf-like tool to interactively select a date in a provided format"
url="https://github.com/nmeum/datepicker"
arch="all"
license="GPL-3.0-or-later"
makedepends="ghc cabal ncurses-dev"
options="net"
source="$pkgname-$pkgver.tar.gz::https://github.com/nmeum/datepicker/archive/$pkgver.tar.gz
	cabal.project.freeze"

# Directory were cabal files are stored.
export CABAL_DIR="$srcdir/dist"

# Needed to fix build on aarch64.
export PATH="$PATH:/usr/lib/llvm15/bin"

cabal_update() {
	cd $builddir
	cabal v2-update
	(
		cabal v2-freeze \
			--shadow-installed-packages \
			--disable-tests
		mv cabal.project.freeze "$startdir/"
	)
}

prepare() {
	default_prepare
	ln -sf "$srcdir/cabal.project.freeze" \
		"$builddir/cabal.project.freeze"
}

build() {
	cabal v2-update
	cabal v2-build $pkgname:exes \
		--jobs=${JOBS:-1} \
		--prefix=/usr \
		--docdir=/usr/share/doc/$pkgname \
		--sysconfdir=/etc
}

package() {
	# See https://github.com/haskell/cabal/issues/6919#issuecomment-761563498
	cabal list-bin $pkgname:exes | xargs install -Dm755 -t "$pkgdir"/usr/bin
}

sha512sums="
ba606a460710d45eeb01fc9ecf6665904b3ca786b455a4de5da6031a5556501be39ac6681ba3899432e94cbb2471db3555a9afa651c0f9b780ba5e620248bd18  datepicker-1.0.0.tar.gz
2524ae1fa809702895b8b6d312256a062070dfb3d49d551176c322537b1da19da772bc29fb52c84202ac9d731b98f2149ca067e7a77692e9526948d1f024b997  cabal.project.freeze
"
