# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=nldev
pkgver=0.3_git20160208
pkgrel=5
verbase=0.3
pkgdesc="A simple netlink device manager"
url="http://git.r-36.net/nldev/"
arch="all"
license="MIT"
depends=""
depends_dev=""
makedepends="linux-headers"
install=""
subpackages="$pkgname-doc"
source="http://files.8pit.net/alpine/distfiles/$pkgname-$pkgver.tar.gz
	${pkgname}.initd
	${pkgname}-trigger.initd

	increase-buffer.patch
	preserve-path.patch
	mdev-path.patch"

disturl="lithium:/var/www/htdocs/files.8pit.net/alpine/distfiles/"
reporev="e8a7f8c4131d39eaff0ebb186f6ee01a08db3e59"
giturl="git://git.r-36.net/$pkgname"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	make CFLAGS="$CFLAGS \${INCS} \${CPPFLAGS}" \
		LDFLAGS="$LDFLAGS \${LIBS}" CC="${CC:-gcc}" \
		-C "$_builddir" || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" PREFIX=/usr install || return 1
	for service in ${pkgname} ${pkgname}-trigger; do
		install -Dm755 "$srcdir"/$service.initd \
			"$pkgdir"/etc/init.d/$service || return 1
	done

	# We don't need run_nldev, use the init script instead
	rm -f "$pkgdir"/usr/bin/run_nldev

	# Install additional documentation
	mkdir -p "$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 FIXES.md README.md \
		"$pkgdir"/usr/share/doc/$pkgname/ || return 1
	install -m644 mdev/etc/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples || return 1
	install -m755 mdev/lib/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples || return 1
}

md5sums="180f83ca7127c933df6b23470f4f00f4  nldev-0.3_git20160208.tar.gz
738f7756bcb5d8ed6bcf626fada7bf4f  nldev.initd
00bc5e09ff60a81c4b55a9447d0f8781  nldev-trigger.initd
05697c7f5073f2fb979499dd03cf5215  increase-buffer.patch
ab3393eddcb8c653d6150e5578e4a36b  preserve-path.patch
d0ec31ac3d291d7407a93eb9937d4723  mdev-path.patch"
sha256sums="5e361bf923b617dd68cc646acdebb83cc730027ac7f8b0dc40cc3a70c4f6915e  nldev-0.3_git20160208.tar.gz
303884e1207f13a6c372cf7dfc244109b368068cd19ed8218a408f726848fe0a  nldev.initd
f747b175939d23a6e6d76aa4abaf4899c4aef012f17f34fa1ee8a0cfb7c49f8a  nldev-trigger.initd
5510964a91ce55e47ee9fc6054682bf000d06c4fffbb40ce92530c59fcc1a211  increase-buffer.patch
79163f03637dc2acae8eea52ae7b3fe17f5687f45a7a07bcb39c092768d511da  preserve-path.patch
cc77fa2599b0b4e18e6307a21081bf4ffe2f0320c114cd2e44a0d2787e780701  mdev-path.patch"
sha512sums="70d9243593030e40735b5d089654f80dce8f8f33f0eea677b30a165be2a78c029688cc05922347ee37538178e5f6302fc8787114d5f0e790ec3018b1d79a56fa  nldev-0.3_git20160208.tar.gz
6b2831cd3b3192c55a7d2b1f009745715236947d3e21c839988714f58b102c51e6c6c25d2de5166e5b27b8f72a21aec6d695082104c99f51aebff0dbec2e36fc  nldev.initd
8f29ce340c066dace3fef213faca430c73998aab1e45c22eb7a29de28ae3fb68228ee9dc6fdec465a8e576ad70191386f6be78d78bd261d8c1b6c4c8b0ac6073  nldev-trigger.initd
155eaaab6fa263280d91f1d8480eff605b2bde4873552f5b6de56d9dc1a9f06fdf452171f38349b80fb53a3817d51440b3f5e3b63e94ee847358d6698cba9aaf  increase-buffer.patch
9040fb970c0c5109fa201298913d3fe854a6b69bda999bc72a03c1a521d3ab0a31327c11fa2893a75fefe5352c3a908dd8d81b6f3ff8b4583e3ffe303a458b26  preserve-path.patch
f779f844fd4753f2dbb2474c5a2b2d90cc6288f9101f2e38b97add521bef8f0bb0abfa55fc75fa9004c7232fdef6a02ce9e19477d91ec7141bd51f59d2221489  mdev-path.patch"
