# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=nldev
pkgver=0.3_git20160208
pkgrel=3
verbase=0.3
pkgdesc="A simple netlink device manager"
url="http://git.r-36.net/nldev/"
arch="all"
license="MIT"
depends=""
depends_dev=""
makedepends="linux-headers"
install=""
subpackages="$pkgname-doc"
source="http://files.8pit.net/alpine/distfiles/$pkgname-$pkgver.tar.gz
	$pkgname.initd

	increase-buffer.patch
	mdev-path.patch"

disturl="lithium:/var/www/htdocs/files.8pit.net/alpine/distfiles/"
reporev="e8a7f8c4131d39eaff0ebb186f6ee01a08db3e59"
giturl="git://git.r-36.net/$pkgname"

_builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	make CFLAGS="$CFLAGS \${INCS} \${CPPFLAGS}" \
		LDFLAGS="$LDFLAGS \${LIBS}" CC="${CC:-gcc}" \
		-C "$_builddir" || return 1
}

package() {
	cd "$_builddir"

	make DESTDIR="$pkgdir" PREFIX=/usr install || return 1
	install -Dm755 "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname || return 1

	# We don't need run_nldev, use the init script instead
	rm -f "$pkgdir"/usr/bin/run_nldev

	# Install additional documentation
	mkdir -p "$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 FIXES.md README.md \
		"$pkgdir"/usr/share/doc/$pkgname/ || return 1
	install -m644 mdev/etc/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples || return 1
	install -m755 mdev/lib/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples || return 1
}

md5sums="180f83ca7127c933df6b23470f4f00f4  nldev-0.3_git20160208.tar.gz
b03761847f96b03a630eba4c27882137  nldev.initd
05697c7f5073f2fb979499dd03cf5215  increase-buffer.patch
2941964739082d3a7b9ef7780251c24e  mdev-path.patch"
sha256sums="5e361bf923b617dd68cc646acdebb83cc730027ac7f8b0dc40cc3a70c4f6915e  nldev-0.3_git20160208.tar.gz
e19a26e7a6bf91be6744dda6579dfc5b80241543aa8014c4af64d02db475810d  nldev.initd
5510964a91ce55e47ee9fc6054682bf000d06c4fffbb40ce92530c59fcc1a211  increase-buffer.patch
ef2df9ae75c8d7426e385075ee6377ec575dbd4ec9c06ca95b98716318a493bf  mdev-path.patch"
sha512sums="70d9243593030e40735b5d089654f80dce8f8f33f0eea677b30a165be2a78c029688cc05922347ee37538178e5f6302fc8787114d5f0e790ec3018b1d79a56fa  nldev-0.3_git20160208.tar.gz
0cc2138d1e20743de176d0aa754d71f5ef9c6acff949308642e34a6822913a8bac6d5234ad8394f51f2eeca5201692a2bc84fc5c1b68eeebd358a023621b9efc  nldev.initd
155eaaab6fa263280d91f1d8480eff605b2bde4873552f5b6de56d9dc1a9f06fdf452171f38349b80fb53a3817d51440b3f5e3b63e94ee847358d6698cba9aaf  increase-buffer.patch
898a020aa0215ca46889a8d5f3eae761e6b3a3c98396c720e8a05bc456bddce52be90e8348858bde67b6deb938bda85282538c9f14353736e0018be92c0f42ff  mdev-path.patch"
