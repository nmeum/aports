# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=p9
pkgver=0_git20200120
_commit=e521180b4735c4480b400c381422fe1776a0ecc8
pkgrel=1
pkgdesc="Idiomatic Go 9P2000.L client and server"
url="https://github.com/nmeum/p9"
arch="all"
license="Apache-2.0"
makedepends="go"
options="net"
source="$pkgname-$pkgver.tar.gz::https://github.com/hugelgupf/p9/archive/$_commit.tar.gz
	p9ufs.initd
	p9ufs.confd"
builddir="$srcdir/github.com/hugelgupf/$pkgname"

export GOPATH="$srcdir"

prepare() {
	default_prepare
	cd "$srcdir"
	mkdir -p "$(dirname "$builddir")"
	cp -r "$srcdir/$pkgname-$_commit" "$builddir"
}

build() {
	mkdir -p bin
	go build -o bin github.com/hugelgupf/p9/cmd/...
}

check() {
	go test ./...
}

package() {
	mkdir -p "$pkgdir"/usr/bin
	install -m755 bin/* "$pkgdir"/usr/bin/

	install -Dm755 "$srcdir"/p9ufs.initd \
		"$pkgdir"/etc/init.d/p9ufs
	install -Dm644 "$srcdir"/p9ufs.confd \
		"$pkgdir"/etc/conf.d/p9ufs
}

cleanup_srcdir() {
	go clean -modcache
	default_cleanup_srcdir
}

sha512sums="99998dd758c9c1768a9dab25e4c690f410b761a2c11a3e1065490d370a6af165c465f03abd7c4b4a66bb54845913d2e562fcf840c10236ee476391ce48668c46  p9-0_git20200120.tar.gz
7c782b4970f5880e2179daebdc5cbae82d380fb8ee3f1004cd4f099fb8289474d740bad163c3c6b33353a56067de838f5a860d230121bd521a6ce4470b10bf1a  p9ufs.initd
5e4d1128cc3aaf15c70cc63765c3fe18121bafcc28fd9b5215b157746be14cc7ca2b6dcb261798d2c15f5b1475f7bba6b9519316641b16c26536262b1381d0e4  p9ufs.confd"
