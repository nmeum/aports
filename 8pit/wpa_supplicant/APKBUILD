# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=wpa_supplicant
pkgver=2.6
pkgrel=1
pkgdesc="A utility providing key negotiation for WPA wireless networks"
url="https://w1.fi/wpa_supplicant/"
arch="all"
license="BSD"
subpackages="$pkgname-doc $pkgname-gui"
depends=""
makedepends="openssl-dev libnl3-dev qt-dev pcsc-lite-dev"
source="http://w1.fi/releases/$pkgname-$pkgver.tar.gz
	wpa_supplicant.initd
	wpa_supplicant.confd

	config
	wpa_cli.sh"

builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$builddir"
	default_prepare || return 1

	# Copy our configuration file to the build directory
	cp "$srcdir"/config "$builddir"/wpa_supplicant/.config || return 1
}

build() {
	cd "$builddir"/wpa_supplicant
	make LIBDIR=/lib BINDIR=/sbin || return 1
	make wpa_gui-qt4 || return 1
	make eapol_test || return 1
}

package() {
	cd "$builddir"/wpa_supplicant
	make DESTDIR="$pkgdir" LIBDIR=/lib BINDIR=/sbin install || return 1
	install -Dm644 wpa_supplicant.conf \
		"$pkgdir"/usr/share/doc/wpa_supplicant/examples/wpa_supplicant.conf || return 1
	install -Dm755 "$srcdir"/wpa_cli.sh \
		"$pkgdir"/etc/wpa_supplicant/wpa_cli.sh || return 1

	local man=
	for man in doc/docbook/*.?; do
		install -Dm644 "$man" \
			"$pkgdir"/usr/share/man/man${man##*.}/${man##*/} \
			|| return 1
	done
	install -Dm755 eapol_test "$pkgdir"/sbin/eapol_test || return 1

	# gui
	install -d "$pkgdir"/usr/bin
	install -m 0755 wpa_gui-qt4/wpa_gui "$pkgdir"/usr/bin/wpa_gui \
		|| return 1

	install -Dm755 "$srcdir"/wpa_supplicant.initd \
		"$pkgdir"/etc/init.d/wpa_supplicant || return 1
	install -Dm644 "$srcdir"/wpa_supplicant.confd \
		"$pkgdir"/etc/conf.d/wpa_supplicant || return 1
}

gui() {
	pkgdesc="Grafical User Interface for $pkgname"
	mkdir -p "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/wpa_gui "$subpkgdir"/usr/bin/
}

md5sums="091569eb4440b7d7f2b4276dbfc03c3c  wpa_supplicant-2.6.tar.gz
c5e8ea7dc22a8fda917158d0881dec7c  wpa_supplicant.initd
bc117427f2c538439f3f1481a028ee06  wpa_supplicant.confd
cec9a12959b4fd820766fb9dd7e87e5e  config
707c26fbf3fa46a6410732efa7128eee  wpa_cli.sh"
sha256sums="b4936d34c4e6cdd44954beba74296d964bc2c9668ecaa5255e499636fe2b1450  wpa_supplicant-2.6.tar.gz
753c85839f7b7a9f5595e77e3cbb54880cae455ea2db5ab91247ca8ec89ab1e7  wpa_supplicant.initd
61ec59007f66ac5bacc0aa095d1f2ccbc977a687038e161a463d1727223d5a90  wpa_supplicant.confd
3b4e4a0eb22253e8e3de1c1f62cc748d2c71d3fe555cb3cf821d606815e5760d  config
dec1d357d8db5067bdba39a300760b06667a6d1b59f15fdb93063d61bf11b596  wpa_cli.sh"
sha512sums="46442cddb6ca043b8b08d143908f149954c238e0f3a57a0df73ca4fab9c1acd91b078f3f26375a1d99cd1d65625986328018c735d8705882c8f91e389cad28a6  wpa_supplicant-2.6.tar.gz
00aa54b4322f2d7b57b52cb63d0964479e8c2932b26f66946a36204b9363814e5c3149c2ede93c92840864456a1ea03e45894606f5f0af545f09571a25077dbc  wpa_supplicant.initd
29103161ec2b9631fca9e8d9a97fafd60ffac3fe78cf613b834395ddcaf8be1e253c22e060d7d9f9b974b2d7ce794caa932a2125e29f6494b75bce475f7b30e1  wpa_supplicant.confd
4aeb2f05f24aa686c331dd5ac73242ea4de8b9033d99468889fa68cd0cef9b259f081a259bea3e401c015f15573383cdc0aaf72b61ad1b16a47a31cc6129cc6b  config
44d33cfe419cdb65cc14f2ac05aa9f8a1b9f2f432181e498071e41ef835662db1e4c5142adf4cfab2475e7b606696169936bd159d1d711f803322db93f242361  wpa_cli.sh"
